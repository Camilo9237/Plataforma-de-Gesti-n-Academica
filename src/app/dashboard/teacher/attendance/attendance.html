<a class="back" routerLink="/dashboard/teacher">â† Volver al Dashboard</a>

<section class="attendance-root">
  <header class="attendance-header">
    <h2>Control de Asistencia</h2>
    <p class="hint">Registra la asistencia diaria de tus estudiantes</p>
  </header>

  <!-- Mensajes de Ã©xito/error -->
  <div *ngIf="successMessage" class="alert alert-success">
    âœ… {{ successMessage }}
  </div>

  <div *ngIf="error" class="alert alert-error">
    âŒ {{ error }}
  </div>

  <div class="selection card">
    <div class="field">
      <label>Grupo *</label>
      <select [(ngModel)]="grupoSeleccionado" (ngModelChange)="onGrupoChange()">
        <option [ngValue]="null">Seleccionar grupo</option>
        <option *ngFor="let g of grupos" [ngValue]="g">{{ g.name }}</option>
      </select>
    </div>
    
    <div class="field">
      <label>Periodo</label>
      <select [(ngModel)]="periodoSeleccionado" [disabled]="!grupoSeleccionado">
        <option [ngValue]="null">Seleccionar periodo</option>
        <option *ngFor="let p of periodos" [ngValue]="p">Periodo {{ p }}</option>
      </select>
    </div>
    
    <div class="field">
      <label>Fecha *</label>
      <input 
        type="date" 
        [(ngModel)]="fechaSeleccionada" 
        (ngModelChange)="onFechaChange()"
        [max]="maxFecha"
      />
    </div>
    
    <div class="field actions">
      <button class="btn" (click)="marcarTodos('presente')" [disabled]="estudiantes.length === 0">
        âœ“ Todos Presentes
      </button>
      <button class="btn" (click)="marcarTodos('ausente')" [disabled]="estudiantes.length === 0">
        âœ— Todos Ausentes
      </button>
    </div>
  </div>

  <!-- Resumen -->
  <div *ngIf="estudiantes.length > 0 && !loading" class="summary card">
    <h4>Resumen</h4>
    <div class="summary-grid">
      <div class="summary-item">
        <span class="icon">ğŸ‘¥</span>
        <span class="value">{{ getResumen().total }}</span>
        <span class="label">Total</span>
      </div>
      <div class="summary-item success">
        <span class="icon">âœ…</span>
        <span class="value">{{ getResumen().presentes }}</span>
        <span class="label">Presentes</span>
      </div>
      <div class="summary-item danger">
        <span class="icon">âŒ</span>
        <span class="value">{{ getResumen().ausentes }}</span>
        <span class="label">Ausentes</span>
      </div>
      <div class="summary-item warning">
        <span class="icon">â°</span>
        <span class="value">{{ getResumen().tardes }}</span>
        <span class="label">Tardes</span>
      </div>
      <div class="summary-item info">
        <span class="icon">ğŸ“</span>
        <span class="value">{{ getResumen().excusas }}</span>
        <span class="label">Excusas</span>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando informaciÃ³n...</p>
  </div>

  <!-- Lista de Estudiantes -->
  <section class="students card" *ngIf="!loading">
    <div class="students-title">Lista de Estudiantes</div>
    <div class="students-sub">
      {{ grupoSeleccionado?.name || 'Selecciona un grupo' }} - 
      {{ fechaSeleccionada | date:'fullDate' }}
    </div>

    <div *ngIf="!grupoSeleccionado" class="empty-state">
      <p>ğŸ‘† Selecciona un grupo para comenzar</p>
    </div>

    <div *ngIf="grupoSeleccionado && estudiantes.length === 0" class="empty-state">
      <p>ğŸ“­ No hay estudiantes matriculados en este grupo</p>
    </div>

    <table class="table" *ngIf="estudiantes.length > 0">
      <thead>
        <tr>
          <th>CÃ³digo</th>
          <th>Nombre</th>
          <th>Estado</th>
          <th>Observaciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let e of estudiantes" [class.ausente]="e.estado === 'ausente'">
          <td class="codigo">{{ e.codigo }}</td>
          <td class="nombre">{{ e.nombre }}</td>
          <td class="estado">
            <select [(ngModel)]="e.estado" class="estado-select">
              <option value="presente">âœ… Presente</option>
              <option value="ausente">âŒ Ausente</option>
              <option value="tarde">â° Tarde</option>
              <option value="excusa">ğŸ“ Excusa</option>
            </select>
          </td>
          <td class="observaciones">
            <input 
              type="text" 
              [(ngModel)]="e.observaciones" 
              placeholder="Opcional"
              class="obs-input"
            />
          </td>
        </tr>
      </tbody>
    </table>

    <div class="actions-row" *ngIf="estudiantes.length > 0">
      <div class="info">
        <span class="hint">
          ğŸ’¡ AsegÃºrate de revisar todos los estados antes de guardar
        </span>
      </div>
      <div class="buttons">
        <button 
          class="btn outline" 
          (click)="cargarEstudiantes()"
          [disabled]="loading || saving">
          ğŸ”„ Recargar
        </button>
        <button 
          class="btn primary" 
          (click)="guardarAsistencia()"
          [disabled]="saving">
          <span *ngIf="!saving">ğŸ’¾ Guardar Asistencia</span>
          <span *ngIf="saving">â³ Guardando...</span>
        </button>
      </div>
    </div>
  </section>
</section>